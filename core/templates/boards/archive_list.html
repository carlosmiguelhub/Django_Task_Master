{% extends "base.html" %}
{% block title %}Archive • Task Master{% endblock %}

{% block body %}
<div class="mx-auto max-w-screen-2xl px-4 sm:px-6 py-8">

  <!-- Header -->
  <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
    <div>
      <h1 class="text-3xl font-semibold tracking-tight text-slate-900">Archive</h1>
      <p class="mt-1 text-sm text-slate-500">All archived completed tasks.</p>
    </div>

    <a href="{% url 'boards:list' %}"
       class="rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-700 hover:bg-slate-50">
      ← Back to Boards
    </a>
  </div>

  <!-- Cards -->
  <div class="mt-8 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
    {% for t in tasks %}
      <div class="rounded-2xl bg-white p-6 shadow-sm ring-1 ring-slate-200">

        <div class="flex items-start justify-between gap-3">
          <div class="min-w-0">
            <h3 class="truncate text-lg font-semibold text-slate-900">{{ t.title }}</h3>
            <p class="mt-1 text-sm text-slate-500 truncate">Board: {{ t.board.name }}</p>
          </div>

          <span class="inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700">
            ✓ DONE
          </span>
        </div>

        <div class="mt-4 flex flex-wrap items-center gap-2">
          {% if t.completed_late %}
            <span class="rounded-full border border-red-200 bg-red-50 px-3 py-1 text-xs font-semibold text-red-700">
              Completed Late
            </span>
          {% else %}
            <span class="rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700">
              Completed On Time
            </span>
          {% endif %}

          {% if t.completed_at %}
            <span class="text-xs text-slate-500">
              {{ t.completed_at|date:"M d, Y" }} • {{ t.completed_at|time:"g:i a" }}
            </span>
          {% endif %}
        </div>

        <div class="mt-5 flex items-center justify-between gap-3 border-t border-slate-100 pt-4">
          <div class="text-xs text-slate-500">
            Archived
          </div>

          {# ✅ Delete instantly (no modal) #}
          <form method="post" action="{% url 'boards:task_delete' t.id %}" class="inline-flex">
            {% csrf_token %}
            <button type="submit"
                    class="inline-flex items-center gap-2 rounded-xl border border-red-200 bg-white px-3 py-2 text-sm font-semibold text-red-700 hover:bg-red-50"
                    title="Delete permanently">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18"></path>
                <path d="M8 6V4h8v2"></path>
                <path d="M19 6l-1 14H6L5 6"></path>
                <path d="M10 11v6"></path>
                <path d="M14 11v6"></path>
              </svg>
              Delete
            </button>
          </form>
        </div>

      </div>
    {% empty %}
      <div class="col-span-full rounded-2xl border border-dashed border-slate-300 bg-white p-10 text-center">
        <p class="text-slate-900 font-semibold">No archived tasks yet</p>
        <p class="mt-1 text-sm text-slate-500">Archive completed tasks to see them here.</p>
      </div>
    {% endfor %}
  </div>

</div>



<script>
  const deleteOverlay = document.getElementById("deleteOverlay");
  const deleteForm = document.getElementById("deleteForm");
  const deleteTaskTitle = document.getElementById("deleteTaskTitle");

  function openDeleteModal(btn){
    const url = btn.dataset.deleteUrl;
    const title = btn.dataset.title || "this task";

    deleteTaskTitle.textContent = title;
    deleteForm.action = url;

    deleteOverlay.classList.remove("hidden");
    deleteOverlay.classList.add("flex");
    document.body.style.overflow = "hidden";
  }

  function closeDeleteModal(){
    deleteOverlay.classList.add("hidden");
    deleteOverlay.classList.remove("flex");
    document.body.style.overflow = "";
  }

  // close if user clicks the dark background
  deleteOverlay.addEventListener("click", (e) => {
    if (e.target === deleteOverlay) closeDeleteModal();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeDeleteModal();
  });
</script>

{% endblock %}
